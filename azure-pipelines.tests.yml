jobs:
  - template: ../../azure-pipelines/jobs/run-tests.yml
    parameters:
      jobName: tests_php80
      serviceName: ci-public-api-php-client
      testCommand: bash -c 'wait-for-it.sh --strict --timeout=120 ci-public-api:8080 && composer ci'
      variables:
        STORAGE_API_URL: $(STORAGE_API_URL__AWS)
      secrets:
        STORAGE_API_TOKEN: $(PUBLIC_API_PHP_CLIENT__STORAGE_API_TOKEN__AWS)
        MANAGE_API_TOKEN: $(INTERNAL_API__MANAGE_TOKEN__AWS)
        AWS_SECRET_ACCESS_KEY: $(AWS_SECRET_ACCESS_KEY)
        AZURE_CLIENT_SECRET: $(AZURE_CLIENT_SECRET)

  - template: ../../azure-pipelines/jobs/run-tests.yml
    parameters:
      jobName: tests_php74
      displayName: Tests (PHP 7.4)
      serviceName: ci-public-api-php-client74
      testCommand: bash -c 'wait-for-it.sh --strict --timeout=120 ci-public-api:8080 && composer ci'
      variables:
        STORAGE_API_URL: $(STORAGE_API_URL__AWS)
      secrets:
        STORAGE_API_TOKEN: $(PUBLIC_API_PHP_CLIENT__STORAGE_API_TOKEN__AWS_74)
        MANAGE_API_TOKEN: $(INTERNAL_API__MANAGE_TOKEN__AWS)
        AWS_SECRET_ACCESS_KEY: $(AWS_SECRET_ACCESS_KEY)
        AZURE_CLIENT_SECRET: $(AZURE_CLIENT_SECRET)
